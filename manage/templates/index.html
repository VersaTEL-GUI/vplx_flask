<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<script src="http://libs.baidu.com/jquery/2.0.0/jquery.js"></script>

<title>manage_flask</title>
<style>
html, body {
	width: 100%;
	height: 100%;
	margin: 0;
	padding: 0;
}

.content {
	width: 500px;
	height: 500px;
	margin: 0 auto;
	position: relative;
	top: 50%;
	margin-top: -250px;
	border: 1px dashed #000;
}

.content_top {
	text-align: center;
	margin: auto;
	border-bottom: 1px solid #000000;
}

.content_middle {
	text-align: center;
	margin: auto;
}
</style>
</head>
<body>
	<div class="content">
	<div class="content_top" hidden="hidden"> 
		<!--  <div class="content_top"> -->
            <p>MASTER IP：<input type="text" id="master_ip" value=""></p>
        </div> 

		<div class="content_middle">
			<p>在master上执行的cmd</p>
			<input type="text" value="" id="cmd_input"> <br> <br>
			<input type="submit" value="提交" onclick="get_cmd_result()"> <br>
			<br>
			<p>执行结果</p>
			<input type="submit" value="查看数据" onclick="see_cmd_result()">
			<textarea name="" id="cmd_result" cols="40" rows="10"></textarea>
		</div>

	</div>
</body>
<script>
    const Base64 = {
            // 转码表
            table : [
                'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
                'I', 'J', 'K', 'L', 'M', 'N', 'O' ,'P',
                'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
                'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
                'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
                'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
                'w', 'x', 'y', 'z', '0', '1', '2', '3',
                '4', '5', '6', '7', '8', '9', '+', '/'
            ],
            UTF16ToUTF8 : function(str) {
                var res = [], len = str.length;
                for (var i = 0; i < len; i++) {
                    var code = str.charCodeAt(i);
                    if (code > 0x0000 && code <= 0x007F) {
                        // 单字节，这里并不考虑0x0000，因为它是空字节
                        // U+00000000 – U+0000007F     0xxxxxxx
                        res.push(str.charAt(i));
                    } else if (code >= 0x0080 && code <= 0x07FF) {
                        // 双字节
                        // U+00000080 – U+000007FF     110xxxxx 10xxxxxx
                        // 110xxxxx
                        var byte1 = 0xC0 | ((code >> 6) & 0x1F);
                        // 10xxxxxx
                        var byte2 = 0x80 | (code & 0x3F);
                        res.push(
                                String.fromCharCode(byte1),
                                String.fromCharCode(byte2)
                        );
                    } else if (code >= 0x0800 && code <= 0xFFFF) {
                        // 三字节
                        // U+00000800 – U+0000FFFF     1110xxxx 10xxxxxx 10xxxxxx
                        // 1110xxxx
                        var byte1 = 0xE0 | ((code >> 12) & 0x0F);
                        // 10xxxxxx
                        var byte2 = 0x80 | ((code >> 6) & 0x3F);
                        // 10xxxxxx
                        var byte3 = 0x80 | (code & 0x3F);
                        res.push(
                                String.fromCharCode(byte1),
                                String.fromCharCode(byte2),
                                String.fromCharCode(byte3)
                        );
                    } else if (code >= 0x00010000 && code <= 0x001FFFFF) {
                        // 四字节
                        // U+00010000 – U+001FFFFF     11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
                    } else if (code >= 0x00200000 && code <= 0x03FFFFFF) {
                        // 五字节
                        // U+00200000 – U+03FFFFFF     111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
                    } else /** if (code >= 0x04000000 && code <= 0x7FFFFFFF)*/ {
                        // 六字节
                        // U+04000000 – U+7FFFFFFF     1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
                    }
                }

                return res.join('');
            },
            UTF8ToUTF16 : function(str) {
                var res = [], len = str.length;
                var i = 0;
                for (var i = 0; i < len; i++) {
                    var code = str.charCodeAt(i);
                    // 对第一个字节进行判断
                    if (((code >> 7) & 0xFF) == 0x0) {
                        // 单字节
                        // 0xxxxxxx
                        res.push(str.charAt(i));
                    } else if (((code >> 5) & 0xFF) == 0x6) {
                        // 双字节
                        // 110xxxxx 10xxxxxx
                        var code2 = str.charCodeAt(++i);
                        var byte1 = (code & 0x1F) << 6;
                        var byte2 = code2 & 0x3F;
                        var utf16 = byte1 | byte2;
                        res.push(Sting.fromCharCode(utf16));
                    } else if (((code >> 4) & 0xFF) == 0xE) {
                        // 三字节
                        // 1110xxxx 10xxxxxx 10xxxxxx
                        var code2 = str.charCodeAt(++i);
                        var code3 = str.charCodeAt(++i);
                        var byte1 = (code << 4) | ((code2 >> 2) & 0x0F);
                        var byte2 = ((code2 & 0x03) << 6) | (code3 & 0x3F);
                        var utf16 = ((byte1 & 0x00FF) << 8) | byte2
                        res.push(String.fromCharCode(utf16));
                    } else if (((code >> 3) & 0xFF) == 0x1E) {
                        // 四字节
                        // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
                    } else if (((code >> 2) & 0xFF) == 0x3E) {
                        // 五字节
                        // 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
                    } else /** if (((code >> 1) & 0xFF) == 0x7E)*/ {
                        // 六字节
                        // 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
                    }
                }

                return res.join('');
            },
            encode : function(str) {
                if (!str) {
                    return '';
                }
                var utf8    = this.UTF16ToUTF8(str); // 转成UTF8
                var i = 0; // 遍历索引
                var len = utf8.length;
                var res = [];
                while (i < len) {
                    var c1 = utf8.charCodeAt(i++) & 0xFF;
                    res.push(this.table[c1 >> 2]);
                    // 需要补2个=
                    if (i == len) {
                        res.push(this.table[(c1 & 0x3) << 4]);
                        res.push('==');
                        break;
                    }
                    var c2 = utf8.charCodeAt(i++);
                    // 需要补1个=
                    if (i == len) {
                        res.push(this.table[((c1 & 0x3) << 4) | ((c2 >> 4) & 0x0F)]);
                        res.push(this.table[(c2 & 0x0F) << 2]);
                        res.push('=');
                        break;
                    }
                    var c3 = utf8.charCodeAt(i++);
                    res.push(this.table[((c1 & 0x3) << 4) | ((c2 >> 4) & 0x0F)]);
                    res.push(this.table[((c2 & 0x0F) << 2) | ((c3 & 0xC0) >> 6)]);
                    res.push(this.table[c3 & 0x3F]);
                }

                return res.join('');
            },
            decode : function(str) {
                if (!str) {
                    return '';
                }

                var len = str.length;
                var i   = 0;
                var res = [];

                while (i < len) {
                    code1 = this.table.indexOf(str.charAt(i++));
                    code2 = this.table.indexOf(str.charAt(i++));
                    code3 = this.table.indexOf(str.charAt(i++));
                    code4 = this.table.indexOf(str.charAt(i++));

                    c1 = (code1 << 2) | (code2 >> 4);
                    c2 = ((code2 & 0xF) << 4) | (code3 >> 2);
                    c3 = ((code3 & 0x3) << 6) | code4;

                    res.push(String.fromCharCode(c1));

                    if (code3 != 64) {
                        res.push(String.fromCharCode(c2));
                    }
                    if (code4 != 64) {
                        res.push(String.fromCharCode(c3));
                    }

                }

                return this.UTF8ToUTF16(res.join(''));
            }
        };
</script>
<script type="text/javascript">
// 获取用户输入的cmd，到master执行并页面显示结果
function get_cmd_result() {
	$.ajax({
		type : "GET",
		url : "/get_master_ip",
		dataType : "json",
		success : function(data) {
			const ip = data;
			$("#master_ip").val(ip);
			const cmd = document.getElementById("cmd_input").value;
			const encode_cmd = Base64.encode(cmd);
			$.ajax({
				type : "GET",
				url : "http://" + ip + ":12122/data/" + encode_cmd + "/",
				success : function(cmddata) {
					alert(cmddata);
				}
			});
		},
		error : function() {
			alert('master ip获取失败')
		}
	});
}

//
function see_cmd_result(){
	const ip = document.getElementById("master_ip").value;
	$.ajax({
			type : "GET",
			url : "http://" + ip + ":12122/cmd_result_data",
			success : function(data) {
				const cmddata = Base64.decode(data)
				$("#cmd_result").val(cmddata);
			},
			error : function() {
				alert('数据获取失败！！！')
			}
	});
}





</script>
</html>